> <font style="color:rgb(51, 51, 51);">简介： ini 是 Windows 上常用的配置文件格式。MySQL 的 Windows 版就是使用 ini 格式存储配置的。</font>  
> [<font style="color:rgb(0, 0, 0);">go-ini</font>](https://github.com/go-ini/ini)<font style="color:rgb(51, 51, 51);">是 Go 语言中用于操作 ini 文件的第三方库。</font>
>
> [go-ini 文档](https://ini.unknwon.io/docs)

1. 安装 `go get github.com/go-ini/ini`
2. 使用

```go
# possible values : production, development
app_mode = development

[paths]
# Path to where grafana can store temp files, sessions, and the sqlite3 db (if that is used)
data = /home/git/grafana

[server]
# Protocol (http or https)
protocol = http

# The http port  to use
http_port = 9999

[mysql]
ip = 127.0.0.1
port = 3306
user = dj
password = 123456
database = awesome

[redis]
ip = 127.0.0.1
port = 6381

```

3. 读取配置文件示例

```go
func main(){
    cfg,err :=ini.Load("my.ini")
    if err!=nil{
        fmt.Printf("Fail to read file:%v",err)
    }
    //通过Section("xx")获取分区，分区就是my.ini文件中用[]方括号写的分区名
    fmt.Println(cfg.Section("").Key("app_mode").String())
    fmt.Println("Data Path:", cfg.Section("paths").Key("data").String())

    // 通过In()方法来对值做选择
    fmt.Println("Server Protocol:",
        cfg.Section("server").Key("protocol").In("http", []string{"http", "https"}))
    // 如果读取的值不在候选列表内，则会回退使用提供的默认值
    fmt.Println("Email Protocol:",
        cfg.Section("server").Key("protocol").In("smtp", []string{"imap", "smtp"}))

     // 自动类型转换
    fmt.Printf("Port Number: (%[1]T) %[1]d\n", cfg.Section("server").Key("http_port").MustInt(9999))
    fmt.Printf("Enforce Domain: (%[1]T) %[1]v\n", cfg.Section("server").Key("enforce_domain").MustBool(false))

    //修改配置文件的值并保存为新的文件
    cfg.Section("").Key("app_mode").setValue("production")
    cfg.SaveTo("my.ini.local)
}
```

4. 数据加载语法
   1. 加载数据源，可以是 []byte 类型的原始数据，string 类型的文件路径或者 io.ReadCloser；可以加载多个数据源
   2. 使用`cfg,err :=ini.Load()`加载数据源；也可以从空白文件开始 `cfg :=ini.Empty()`，然后用`cfg.Append()`添加需要加载的文件
   3. 加载一系列文件，但是不确定文件是否全部存在，使用`cfg,err :=ini.LooseLoad()`方法；当那些之前不存在的文件在重新调用 Reload() 方法的时候突然出现了，那么它们会被正常加载
   4. 跳过无法识别的数据行

```go
cfg, err := ini.LoadSources(ini.LoadOptions{
    SkipUnrecognizableLines:
true
,
},
"other.ini"
)
```

5. 数据覆盖
   1. <font style="color:rgb(33, 37, 41);">如果加载两个配置文件 </font>`<font style="color:rgb(232, 62, 140);">my.ini</font>`<font style="color:rgb(33, 37, 41);"> 和 </font>`<font style="color:rgb(232, 62, 140);">my.ini.local</font>`<font style="color:rgb(33, 37, 41);">，</font>`<font style="color:rgb(232, 62, 140);">app_mode</font>`<font style="color:rgb(33, 37, 41);"> 的值会由后一个配置文件决定</font>
   2. <font style="color:rgb(33, 37, 41);">若不想数据被覆盖，需要使用</font>`<font style="color:rgb(33, 37, 41);">ShadowLoad()</font>`<font style="color:rgb(33, 37, 41);">加载数据源</font>
6. 操作分区 Section
   1. GetSection `<font style="color:rgb(56, 58, 66);background-color:rgb(250, 250, 250);">sec, err := cfg.GetSection(</font><font style="color:rgb(80, 161, 79);">"section name"</font><font style="color:rgb(56, 58, 66);background-color:rgb(250, 250, 250);">)</font>`
   2. Section `sec := cfg.Section("section name")`，这里没有返回值不能判断分区是否存在，若不存在会自动创建一个新的分区对象
   3. NewSection `err :=cfg.NewSection("xx")`创建新分区
   4. Sections()获取分区的所有对象
   5. SectionsStrings()获取所有分区名称
   6. 父子分区
      1. <font style="color:rgb(33, 37, 41);">在分区名称中使用 </font>`<font style="color:rgb(232, 62, 140);">.</font>`<font style="color:rgb(33, 37, 41);"> 来表示两个或多个分区之间的父子关系。如果某个键在子分区中不存在，则会去它的父分区中再次寻找，直到没有父分区为止。</font>

```go
NAME = ini
VERSION = v1
IMPORT_PATH = gopkg.in/%(NAME)s.%(VERSION)s

[package]
CLONE_URL = https://%(IMPORT_PATH)s

[package.sub]
```
